@{
    ViewData["Title"] = "Completed CRF List";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<div class="container-fluid mt-4">
    <h3 class="text-success">Completed Verifications</h3>

    <div class="card">
        <div class="card-body">
            <form id="completedFilter" class="row g-3">
                <div class="col-md-4">
                    <input type="date" class="form-control" id="cFromDate" required />
                </div>
                <div class="col-md-4">
                    <input type="date" class="form-control" id="cToDate" required />
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-success">Load Completed</button>
                </div>
            </form>
        </div>
    </div>

    <div class="table-responsive mt-4" id="completedTableContainer" style="display:none;">
        <table class="table table-bordered" id="completedTable">
            <thead>
                <tr>
                    <th>CRF ID</th>
                    <th>Name</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Tester Remarks</th>
                    <th>TL Remarks</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('completedFilter').addEventListener('submit', async e => {
            e.preventDefault();
            const from = document.getElementById('cFromDate').value;
            const to = document.getElementById('cToDate').value;

            const res = await fetch(`/api/DailyVerification?fromDate=${from}&toDate=${to}&pageval=report`);
            const data = await res.json();

            const tbody = document.querySelector('#completedTable tbody');
            tbody.innerHTML = '';
            data.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                            <td>${item.CRF_ID}</td>
                            <td>${item.SUBJECT}</td>
                            <td>${item.RELEASE_DATE}</td>
                            <td>${item.CURRENT_STATUS}</td>
                            <td>${item.REMARKS || '-'}</td>
                            <td>${item.TL_REMARKS || '-'}</td>
                        `;
                tbody.appendChild(tr);
            });

            document.getElementById('completedTableContainer').style.display = 'block';
        });
    </script>
}